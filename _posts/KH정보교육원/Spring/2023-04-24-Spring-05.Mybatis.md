---
title : 05. Mybatis
date : 2023-04-24 +09:00
categories : [KH í•™ì› ê³µë¶€, Spring]
tags : [
  Spring,
]
---
<!-- ![](/assets/img/Spring/aaaa.png){:style="border:1px solid #eaeaea; border-radius: 7px; padding: 0px;" } -->
<!-- ![](/assets/img/Spring/5-1.png){:style="width:1000px" } -->
<!-- <a href="" target="_blank"></a> -->

1) ê°œìš”

```
ë°ì´í„°ì˜ ì…ë ¥, ì¡°íšŒ, ìˆ˜ì •, ì‚­ì œ (CRUD)ë¥¼ ë³´ë‹¤ í¸í•˜ê²Œ í•˜ê¸° ìœ„í•´ xmlë¡œ êµ¬ì¡°í™”í•œ Mapper ì„¤ì • íŒŒì¼ì„ í†µí•´ì„œ JDBCë¥¼ êµ¬í˜„í•œ ì˜ì†ì„± í”„ë ˆì„ì›Œí¬

ê¸°ì¡´ì˜ JDBCì—ì„œ ì‚¬ìš©í•˜ë˜ ë¶€ë¶„ë“¤ì„ xml ì„¤ì •ì„ í†µí•´ ì‰½ê²Œ í•  ìˆ˜ ìˆê²Œ í•´ì¤€ë‹¤
```

<a href="https://mybatis.org/mybatis-3/ko/" target="_blank">https://mybatis.org/mybatis-3/ko/</a>


2) Mybatisì˜ íë¦„

![](/assets/img/Spring/5-1.png){:style="width:1000px" }

3) ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ê°€

ğŸ”¸JDBC ë“œë¼ì´ë²„ (ojdbc11)    
<a href="https://mvnrepository.com/artifact/com.oracle.database.jdbc/ojdbc11" target="_blank">https://mvnrepository.com/artifact/com.oracle.database.jdbc/ojdbc11</a>

ğŸ”¸Springì—ì„œ JDBC ì§€ì›í•˜ëŠ” ëª¨ë“ˆ (spring-jdbc)     
<a href="https://mvnrepository.com/artifact/org.springframework/spring-jdbc" target="_blank">https://mvnrepository.com/artifact/org.springframework/spring-jdbc</a>

ğŸ”¸Mybatis ë¼ì´ë¸ŒëŸ¬ë¦¬ (mybatis)     
<a href="https://mvnrepository.com/artifact/org.mybatis/mybatis" target="_blank">https://mvnrepository.com/artifact/org.mybatis/mybatis</a>

ğŸ”¸Springì—ì„œ ì‰½ê²Œ Mybatisë¥¼ ì‚¬ìš© ê°€ëŠ¥í•˜ê²Œ ë§Œë“œëŠ” ëª¨ë“ˆ (spring-mybatis)     
<a href="https://mvnrepository.com/artifact/org.mybatis/mybatis-spring" target="_blank">https://mvnrepository.com/artifact/org.mybatis/mybatis-spring</a>

ğŸ”¸DataBase Connection Pool ì‚¬ìš©ì„ ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ (commons-dbcp2)    
<a href="https://mvnrepository.com/artifact/org.apache.commons/commons-dbcp2" target="_blank">https://mvnrepository.com/artifact/org.apache.commons/commons-dbcp2</a>

`pom.xmlì˜ <dependencies></dependencies> ì•ˆì— ì½”ë“œ ì¶”ê°€`

4) Mybatisì˜ ë™ì‘ êµ¬ì¡°

![](/assets/img/Spring/5-2.png){:style="width:1000px" }

5) mybatis-config ì„¤ì •í•˜ê¸°

![](/assets/img/Spring/5-3.png){:style="width:1000px" }

```
- Config
Location : http://mybatis.org/dtd/mybatis-3-config.dtd
Key type : Public ID
Key : -//mybatis.org//DTD Config 3.0//EN

- Mapper
Location : http://mybatis.org/dtd/mybatis-3-mapper.dtd
Key type : Public ID
Key : -//mybatis.org//DTD Mapper 3.0//EN
```

![](/assets/img/Spring/5-4.png){:style="width:1000px" }
![](/assets/img/Spring/5-5.png){:style="width:1000px" }
![](/assets/img/Spring/5-6.png){:style="width:1000px" }

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE configuration PUBLIC "-//mybatis.org//DTD Config 3.0//EN" "http://mybatis.org/dtd/mybatis-3-config.dtd" >
<configuration>

  <!-- SqlSessionTemplate ìƒì„± ì‹œ ì ìš©ë  ì„¤ì • ì‘ì„± ë¶€ë¶„ -->
  <settings>
    <!-- insert ë˜ëŠ” updateì— ì‚¬ìš©ë˜ëŠ” ê°’ ì¤‘ nullì´ ìˆì„ ê²½ìš°ì— ëŒ€í•œ ì„¤ì •
    í•´ë‹¹ ì„¤ì •ì´ ì—†ì„ ê²½ìš° -> SQL êµ¬ë¬¸ì— null í¬í•¨ë˜ì–´ ìˆë‹¤ëŠ” ì˜¤ë¥˜ ë°œìƒ.
    í•´ìƒ ì„¤ì •ì´ ìˆì„ ê²½ìš° -> ì˜¤ë¥˜ë¥¼ ë°œìƒ ì‹œí‚¤ì§€ ì•Šê³  NULL ê°’ì„ ì»¬ëŸ¼ì— ëŒ€ì…
    ë‹¨, NOT NULL ì œì•½ì¡°ê±´ì´ ì—†ëŠ” ì»¬ëŸ¼ì—ë§Œ ê°€ëŠ¥í•¨.
    
    ** value ì„¤ì • ì‹œ NULL ì€ ë°˜ë“œì‹œ ëŒ€ë¬¸ìë¡œ ì‘ì„± (ì†Œë¬¸ì nullì€ ì˜¤ë¥˜ê°€ ë°œìƒí•¨) -->
    <setting name="jdbcTypeForNull" value="NULL"/>
  </settings>
  
  <!-- ë³„ì¹­ ì‘ì„± ë¶€ë¶„  -->
  <!-- VOí´ë˜ìŠ¤ì˜ íŒ¨í‚¤ì§€ëª… + í´ë˜ìŠ¤ëª… ì‘ì„±í•˜ëŠ” ê²ƒì´ ë¶ˆí¸í•˜ê¸° ë•Œë¬¸ì— ì§§ì€ ë³„ì¹­ ë¶€ì—¬ -->
  <typeAliases>
    <typeAlias type="edu.kh.fin.member.model.vo.Member" alias="Member"/>
  </typeAliases>
  
  <!-- mapper íŒŒì¼(SQL ì‘ì„±ë˜ëŠ”íŒŒì¼) ìœ„ì¹˜ ë“±ë¡ ë¶€ë¶„ -->
  <!-- <mapper resource="mapper íŒŒì¼ ê²½ë¡œ"/> 
    ê²½ë¡œë¥¼ ì‘ì„±í•˜ëŠ” ê¸°ì¤€(ì‹œì‘ì§€ì )ì€ src/main/resources í´ë” -->
  <mappers>
    <mapper resource="/mappers/member-mapper.xml"/>
  </mappers>

</configuration>
```

`â­ ìœ„ì˜ ì½”ë“œ ìˆœì„œëŠ” ë°˜ë“œì‹œ ì§€ì¼œì ¸ì•¼ í•œë‹¤ â­`

6) root-context.xml ì„¤ì •í•˜ê¸°

![](/assets/img/Spring/5-7.png){:style="width:1000px" }

```xml
<!--
  root-context.xml íŒŒì¼
  - web.xmlì—ì„œ ê°€ì¥ ë¨¼ì € ì½ì–´ ë“¤ì´ëŠ” ì„¤ì • íŒŒì¼
  - í”„ë¡œì íŠ¸ ì „ë°˜ì ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” ìì›ì„ ìƒì„±(bean ë“±ë¡)í•˜ê³  ì„¤ì •í•˜ëŠ” íŒŒì¼
  - DB ì—°ê²° ê´€ë ¨ ì •ë³´, íŠ¸ëœì­ì…˜ ì²˜ë¦¬, íŒŒì¼ ì—…ë¡œë“œ ë“±ì„ ì‘ì„±
-->

<!-- 1. DBCP ì‚¬ìš©ì„ ìœ„í•œ DataSourceë¥¼ beanìœ¼ë¡œ ë“±ë¡ -->

<!-- DataSource : javaì—ì„œ Connection Poolì„ ì§€ì›í•˜ê¸° ìœ„í•œ ì¸í„°í˜ì´ìŠ¤(Connection ìƒìœ„í˜¸í™˜) -->
<!-- destroy-method="close" : ì£¼ì–´ì§„ ì„¸ì…˜ì„ ìë™ìœ¼ë¡œ ë°˜í™˜(close)í•˜ëŠ” ì„¤ì • -->
<bean id="dataSource" class="org.apache.commons.dbcp2.BasicDataSource" destroy-method="close">
  <property name="driverClassName" value="oracle.jdbc.driver.OracleDriver" />
  <property name="url" value="jdbc:oracle:thin:@localhost:1521:xe"/>
  <property name="username" value="community"/>
  <property name="password" value="1234"/>

  <!-- SQLì´ ìˆ˜í–‰ëœ í›„ ìë™ìœ¼ë¡œ Commit ë˜ëŠ”ê²ƒì„ ì§€ì • -->
  <property name="defaultAutoCommit" value="false"/>

  <!-- ì»¤ë„¥ì…˜ í’€ ì„¤ì • -->
  <property name="initialSize" value="10" /> <!-- ì´ˆê¸° ì»¤ë„¥ì…˜ ìˆ˜, ê¸°ë³¸ 0 -->
  <property name="maxTotal" value="50" /> <!-- ìµœëŒ€ ì»¤ë„¥ì…˜ ìˆ˜, ê¸°ë³¸ 8 -->
  <property name="maxIdle" value="20" /> <!-- ìœ íœ´ ìƒíƒœë¡œ ì¡´ì¬í•  ìˆ˜ ìˆëŠ” ì»¤ë„¥ì…˜ ìµœëŒ€ ìˆ˜, ê¸°ë³¸ 8 -->
  <property name="minIdle" value="10" /> <!-- ìœ íœ´ ìƒíƒœë¡œ ì¡´ì¬í•  ìˆ˜ ìˆëŠ” ì»¤ë„¥ì…˜ ìµœì†Œ ìˆ˜, ê¸°ë³¸ 0 -->
  <property name="maxWaitMillis" value="-1" /> <!-- ì˜ˆì™¸ ë°œìƒ ì „ ì»¤ë„¥ì…˜ì´ ë°˜í™˜ ë  ë–„ ê¹Œì§€ ëŒ€ê¸°í•˜ëŠ” ìµœëŒ€ ì‹œê°„(ms), ê¸°ë³¸ -1(ë¬´ê¸°í•œ) -->

</bean>
```

![](/assets/img/Spring/5-8.png){:style="width:1000px" }

```xml
<!-- 
  SqlSession : sqlêµ¬ë¬¸ì„ DBì— ì „ë‹¬, ì‹¤í–‰í•˜ëŠ” ê°ì²´ 
  SqlSessionFactory : SqlSessionì„ ë§Œë“œëŠ” ê°ì²´ 
  sqlSessionFactoryBean : mybatis ì„¤ì • íŒŒì¼(mybatis-config.xml)ê³¼ Connection Pool ì •ë³´ë¥¼ ì´ìš©í•˜ì—¬ SqlSessionFactoryë¥¼ ë§Œë“œëŠ” ê°ì²´ 
  sqlSessionTemplate : SqlSession ê°ì²´ì— íŠ¸ëœì­ì…˜ ì²˜ë¦¬ ì—­í• ì´ ê°€ëŠ¥í•˜ë„ë¡ í•˜ëŠ” ê°ì²´ 
-->

<!-- ë§ˆì´ë°”í‹°ìŠ¤ SqlSession ë“±ë¡í•˜ê¸° (xml ë°©ì‹ìœ¼ë¡œ bean ë“±ë¡) -->
<bean id="sqlSessionFactoryBean" class="org.mybatis.spring.SqlSessionFactoryBean">
  <!-- mybatis-config.xml ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸° -->
  <property name="configLocation" value="classpath:mybatis-config.xml" />
  <property name="dataSource" ref="dataSource" />
</bean>

<!-- SqlSessionTemplate : ê¸°ë³¸ SQL ì‹¤í–‰ + íŠ¸ëœì­ì…˜ ê´€ë¦¬ ì—­í• ì„ í•˜ëŠ” SqlSessionì„ ìƒì„±í•  ìˆ˜ ìˆê²Œ í•˜ëŠ” ê°ì²´(Spring beanìœ¼ë¡œ ë“±ë¡í•´ì•¼í•¨.) -->
<bean id="sqlSessionTemplate" class="org.mybatis.spring.SqlSessionTemplate">
  <constructor-arg ref="sqlSessionFactoryBean" />
</bean>

<!-- ìŠ¤í”„ë§ì—ì„œ ì‚¬ìš©í•˜ëŠ” proxyë¥¼ ì´ìš©í•œ íŠ¸ëœì­ì…˜ ì œì–´ê°€ ì•ˆë  ê²½ìš° ì¶”ê°€ì ì¸ íŠ¸ëœì­ì…˜ ë§¤ë‹ˆì €ë¥¼ ì¶”ê°€í•´ì„œ ë¬¸ì œ í•´ê²° -->
<bean id="transactionManager" 
  class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
  <property name="dataSource" ref="dataSource" />
</bean>
```
