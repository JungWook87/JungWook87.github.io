---
published : true
title : 07.SSO(Single Sign On)
date : 2024-02-13 +09:00
categories : [MSA, MSA]
tags : [
  MSA,
]
---
<!-- ![](/assets/img/Spring/aaaa.png){:style="border:1px solid #eaeaea; border-radius: 7px; padding: 0px;" } -->
<!-- ![](/assets/img/MSA/15.png){:style="width:1000px" } -->

### SSO(Single Sign On)
- 한 번의 로그인을 통해 여러 어플리케이션(서비스)를 이용할 수 있게 하는 서비스를 말한다
- 장점
  - 여러 웹사이트의 암호를 기억할 필요없이, 사용자는 하나의 로그인 창구를 통해 여러 웹사이트에 접근할 수 있는 권한을 손쉽게 얻을 수 있다.
  - 한번의 로그인으로 여러 웹사이트 동시 접근이 가능하고, 업무의 생산성이 향상
  - 여러 웹사이트의 암호를 각각의 서비스에서 관리하지 않아도 되기 때문에, 이러한 인증과정에 필요한 보안 시스템의 비용이 절감된다.
  - 연결된 모든 웹사이트에 동일하게 높은 수준의 보안 시스템을 적용할 수 있다
  - 사용자가 이전보다 훨씬 편리하게 여러 웹사이트를 이용할 수 있다.
- Delegation Model과 Propagation Model 2가지 모델이 있다.

### 1. Delegation Model
![](/assets/img/MSA/14.png){:style="width:1000px" }

- Target Service에서 현재 사용중인 인증방식을 새롭게 변경하기 어려운 경우에 사용한다
- 사용자의 인증 정보를 Sing On Agent에서 관리하여 대신 로그인 해주는 방식이다
  - 1.Target Service1에 로그인 하기위한 정보가 id/pw인 경우,
  - 2.Sign On Agent가 Authentication Infos에 Target Service1의 로그인 정보가 있는지 확인하고,
  - 3.있다면 user를 대신하여 Sign On Agent가 Target Service1으로 로그인을 대신 해준다.

### 2. Propagation Model
![](/assets/img/MSA/15.png){:style="width:1000px" }

- 통합 인증을 수행하는 Authentication Service에서 Authentication Token(인증 토큰)을 발급 받는다.
  - 1.user가 Target Service1로 접근하기 위해 발급받은 인증 토큰을 Target Service1으로 전달한다.
  - 2.Target Service1에서는 인증 토큰을 보고 인증받은 user인지 파악한다.

### SSO 구현방식
- 일반적으로 SSO는 SAML, OAuth2.0, OIDC 방식으로 구현한다. 각 방법마다 간략한 차이점이 있다.

<table>
  <tr>
    <th>.</th>
    <th>SAML</th>
    <th>OAuth2.0</th>
    <th>OIDC</th>
  </tr>
  <tr>
    <td>Format</td>
    <td>XML</td>
    <td>JSON</td>
    <td>JSON</td>
  </tr>
  <tr>
    <td>Authorization</td>  
    <td>O</td>  
    <td>O</td>  
    <td>X</td>  
  </tr>
  <tr>
    <td>Authentication</td>  
    <td>O</td>  
    <td>Pseudo-authentication</td>  
    <td>O</td>  
  </tr>
    <tr>
    <td>Best Suited for</td>  
    <td>SSO for Enterprise(Not well suited for mobile)</td>  
    <td>API authorization</td>  
    <td>SSO for consumer apps</td>  
  </tr>
</table>

- Authorization : 인가, 내가 보유하고 있는 권한에 대한 표시(관리자, 사용자)
- Authentication : 인증, 내가 누구인지에 대한 표시(회원, 비회원)

#### 1. SAML
- 인증정보를 제공하는 곳(Sign On Agent / Authentication Service)과 서비스를 제공하는 곳(Target Service)사이에서 인증 정보를 교환하기 위해 사용되는 프로토콜 또는 규칙의 집합
- XML 기반의 표준 데이터 포멧을 갖는다.
- SAML이 등장한 이후로 대부분의 기업이 독자적인 인터페이스 또는 특정 SSO 솔루션을 통해 시스템을 구축하지 않고, 인증 정보를 XML이라는 공통 포멧으로 생성하고 이를 암호화하여 제 3자에게 내용을 노출시키지 않고 데이터를 수신해야 하는 위치까지 안전하게 전달할 수 있게 되었다.

![](/assets/img/MSA/16.png){:style="width:1000px" }

- 이 때 생성되는 XML을 Assertion이라고 부르는데, Assertion 내부에는 ID 공급자 이름, 발행일, 만료일 등의 정보가 포함되어 있다.

<hr>

- 인증 과정
![](/assets/img/MSA/17.png){:style="width:1000px" }

1. 유저가 인증 서비스에 접근하면, Service Provider가 해당 유저의 과거 인증 여부를 확인한다.
2. Service Provider가 인증 요청(SAML Request)를 생성하고, 이를 클라이언트(Browser)에 전송한다.
3. User의 Browser가 전달받은 SAMLRequest를 Identity Provider로 리다이렉트한다. 중요한 것은 Service Provider와 Identity Provider는 직접 통신하지 않는다
4. Identity Provider는 SAMLRequest를 파싱하고, User를 인증한다
5. 인증이 성공하면 SAMLResponse를 생성하여 User의 Browser로 전송한다. SAMLResponse는 XML 형식이다. 내부에 SAMLAssertion을 포함하고 있다.
6. Identity Provider는 Browser에 Session Cookie를 설정하고, 이를 Browser에 캐싱한다.
7. SAMLResponse가 Service Provider의 Assertion Consumer Service의 URL 주소로 POST된다.
8. Assertion Consumer Service는 SAMLResponse를 검증한다
9. 검증 결과가 유효하면 User가 요청한 서비스로 이동한다

<hr>

- 문제점
- SAMLRequest, SAMLResponse 모두 XML 형식이기 때문에 모바일 또는 Native Application이 아닌 Browser에서만 동작한다

#### 2. OAuth2.0

##### 참고 사이트
<a href="https://wnjoon.github.io/2022/12/30/swe-sso/">월리의 탐구생활-한번의 로그인을 통해 여러 어플리케이션 접근이 가능하도록 하는 SSO(Single Sign On)</a>
