---
published : true
title : 02.Spring Security 구현
date : 2024-02-15 +09:00
categories : [Spring, Security]
tags : [
  Security,
]
---
<!-- ![](/assets/img/Spring/aaaa.png){:style="border:1px solid #eaeaea; border-radius: 7px; padding: 0px;" } -->
<!-- ![](/assets/img/Security/1.png){:style="width:1000px"} -->

- 디펜던시를 추가한 다음에 적절한 패키지를 생성하고, SecurityConfig 클래스를 추가한다. 
- 패키지는 스프링 프로젝트의 패키지 하부에 있어야 한다.

```java
@EnableWebSecurity
public class SecurityConfig extends WebSecurityConfigurerAdapter{
}
```

- 위와 같이 설정해주면, 이제 사이트 전체가 잠겨서, 비밀번호를 쳐야 접근할 수 있게 된다.
- 원활한 프로젝트 진행을 위해 일단 페이지의 인증을 해제한다.

```java
import com.example.member.Role;
import org.springframework.boot.autoconfigure.security.servlet.PathRequest;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.web.SecurityFilterChain;

@Configuration
@EnableWebSecurity
public class SecurityConfig{

  @Bean
  public SecurityFilterChain filterChain(HttpSecurity http) throws Exception{

    http
            .csrf((csrfConfig) ->
                    csrfConfig.disable()
            ) // 1번
            .headers((headerConfig) ->
                    headerConfig.frameOptions(frameOptionsConfig ->
                            frameOptionsConfig.disable()
                    )
            ) // 2번
            .authorizeHttpRequests((authorizeRequests) ->
                    authorizeRequests
                        .requestMatchers(PathRequest.toH2Console()).permitAll()
                        .requestMatchers("/", "/login/**").permitAll()
                        .requestMatchers("/boards/**", "/api/boards/**").hasRole(Role.USER.name())
                        .requestMatchers("/admins/**", "/api/v1/admins/**").hasRole(Role.ADMIN.name())
                        .anyRequest().authenticated()
            ); // 3번

    return http.build();
  }
}
```

- 1.. csrf(Cross site Request Forgery) 설정을 disable 하였다.
- 2.. h2-console 화면을 사용하기 위해 해당 옵션들을 disable 하였다.
- 3.. 프로젝트 view 구성에서 보았듯이 자원 요청 별 권한 설정을 하였다
  - 위에서부터 순서대로
  - h2-console을 사용하기 위한 설정(스프링 시큐리티 6.0.0 이상 버전부터 저 설정을 하지 않으면 h2-console에 들어갈 수 없다)
  - 메인화면과 로그인 및 회원가입 화면은 권한에 상관없이 접근할 수 있어야 하기 때문에 permitAll로 모든 접근을 허용하였다
  - boards 관련 요청은 로그인 인증을 하여 USER 권한을 획득한 사용자만 접근 할 수 있기에 hasRole(Role.USER.name()) 설정을 하였다.
  - admin 관련 요청은 ADMIN 권한이 있어야 접근이 가능하기에 hasRole(Role.ADMIN.name()) 설정을 하였다.

<hr>

- @EnableWebSecurity는 모든 요청 URL이 스프링 시큐리티의 제어를 받도록 만드는 어노테이션이다
- @EnableWebSecurity 어노테이션을 사용하면 내부적으로 SpringSecurityFilterChain이 동작하여 URL 필터가 적용된다.
- member 패키지 밑에 Role Enum을 만든다

```java
@Getter
@RequiredArgsConstructor
public enum Role{
  USER("ROLE_USER", "일반사용자"),
  ADMIN("ROLE_ADMIN", "일반관리자");

  private final String key;
  private final String title;
}
```

- 다시 서버를 재기동하면 permitAll() 설정한 요청은 로그인 없이 접근이 가능하게 된다.
